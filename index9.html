<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>حِساب التكليف الشرعي — واجبات المكلّف</title>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f5f6f8; --ink:#111827; --muted:#6b7280;
    --card:#ffffff; --line:#e5e7eb;
    --gold:#b58900; --gold-soft:#f5d574;
    --emerald:#059669; --crimson:#dc2626;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:"Cairo",sans-serif; background:var(--bg); color:var(--ink)}
  header{text-align:center; padding:24px 12px}
  .brand{font-family:"Amiri",serif; font-size:clamp(26px,4.5vw,42px); color:var(--gold)}
  .tag{margin-top:6px; font-size:14px; color:var(--muted)}
  .shell{max-width:900px; margin:0 auto; padding:0 16px}
  .hero{background:var(--card); border:1px solid var(--line); border-radius:20px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,.05)}
  .row{display:grid; gap:16px}
  @media(min-width:860px){ .row{grid-template-columns:1.2fr .8fr} }
  .field{display:flex; flex-direction:column; gap:8px; margin-bottom:12px}
  .center{text-align:center}
  .date-grid{display:flex; justify-content:center; gap:8px; flex-wrap:wrap}
  .date-grid input[type="number"]{
    width:110px; padding:10px; border:1px solid var(--line); border-radius:10px; text-align:center; font-family:monospace;
  }
  .seg{display:flex; gap:6px; justify-content:center}
  .seg button{flex:1; padding:8px; border-radius:8px; border:1px solid var(--line); background:#f9fafb; cursor:pointer; max-width:120px}
  .seg button.on{background:var(--gold); color:#fff; border-color:var(--gold)}
  .btn{padding:12px 20px; border-radius:10px; border:none; cursor:pointer; background:linear-gradient(90deg,var(--gold),var(--gold-soft)); color:#111; font-weight:700; display:block; margin:0 auto}
  .badge{display:inline-block; padding:10px 14px; border-radius:10px; margin-top:10px}
  .ok{background:#d1fae5; color:var(--emerald)}
  .no{background:#fee2e2; color:var(--crimson)}
  .kpi{display:grid; gap:10px; grid-template-columns:repeat(2,1fr); margin-top:10px}
  @media(min-width:760px){ .kpi{grid-template-columns:repeat(4,1fr)} }
  .k{background:#f9fafb; border:1px solid var(--line); border-radius:10px; padding:10px; text-align:center}
  .k .v{font-weight:700; font-size:18px}
  .deck{display:grid; gap:12px; grid-template-columns:1fr; margin-top:16px}
  @media(min-width:860px){ .deck{grid-template-columns:repeat(3,1fr)} }
  .card{background:#fdfdfd; border:1px solid var(--line); border-radius:12px; padding:14px; box-shadow:0 2px 6px rgba(0,0,0,.04)}
  .card h3{margin:0 0 6px; font-family:"Amiri",serif; color:var(--gold)}
  .card p{margin:0; font-size:14px; color:#374151; line-height:1.6}
  .card ul{margin:8px 0 0; padding-inline-start:20px; color:#374151}
  .sharebar{display:flex; justify-content:center; gap:8px; margin:16px 0; flex-wrap:wrap}
  .iconbtn{width:34px; height:34px; border-radius:8px; display:flex; align-items:center; justify-content:center; border:1px solid var(--line); background:#fff; cursor:pointer}
  .iconbtn svg{width:18px; height:18px; fill:#374151}
  footer{text-align:center; margin:12px 0 16px; font-size:12px; color:var(--muted)}
  /* إبقاء التذييل يبدو كنص عادي (بدون مؤشر يد) */
  footer#devLink{cursor:default}
</style>
</head>
<body>
<header>
  <div class="brand">حِساب التكليف الشرعي</div>
  <div class="tag">أدخل تاريخ الميلاد (ميلادي) واختر الجنس. الحساب قمري ويعرض المعادل الميلادي التقريبي.</div>
</header>

<main class="shell">
  <section class="hero">
    <div class="row">
      <div>
        <!-- التاريخ -->
        <div class="field center">
          <label><strong>تاريخ الميلاد (ميلادي)</strong></label>
          <div class="date-grid" dir="ltr">
            <input id="y" type="number" inputmode="numeric" placeholder="السنة" min="1900" max="2100"/>
            <input id="m" type="number" inputmode="numeric" placeholder="الشهر" min="1" max="12"/>
            <input id="d" type="number" inputmode="numeric" placeholder="اليوم" min="1" max="31"/>
          </div>
        </div>

        <!-- الجنس -->
        <div class="field center">
          <label><strong>الجنس</strong></label>
          <div class="seg" id="gender">
            <button type="button" class="on" data-g="girl">فتاة</button>
            <button type="button" data-g="boy">صبي</button>
          </div>
        </div>

        <button class="btn" id="calc">تحقّق من الحكم</button>
      </div>

      <div>
        <div id="verdict" style="display:none"></div>
        <div id="kpis" class="kpi" style="display:none">
          <div class="k"><div class="v" id="solarY">—</div><div>العمر الشمسي (سنوات)</div></div>
          <div class="k"><div class="v" id="hijriY">—</div><div>العمر القمري (سنوات)</div></div>
          <div class="k"><div class="v" id="threshold">—</div><div>سنّ التكليف القمري</div></div>
          <div class="k"><div class="v" id="status">—</div><div>الحالة اليوم</div></div>
        </div>
        <div id="eqDates" class="kpi" style="display:none; grid-template-columns:repeat(2,1fr); margin-top:8px">
          <div class="k"><div class="v" id="eqGirl">—</div><div>بلوغ الفتاة (تقريب ميلادي)</div></div>
          <div class="k"><div class="v" id="eqBoy">—</div><div>بلوغ الصبي (تقريب ميلادي)</div></div>
        </div>
      </div>
    </div>

    <div id="rules" class="deck" style="display:none"></div>
  </section>

  <!-- أيقونات المشاركة -->
  <div class="sharebar" id="sharebar">
    <!-- واتساب -->
    <a class="iconbtn" id="shareWA" title="واتساب" target="_blank" aria-label="WhatsApp">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 0a12 12 0 00-10 18.3L1 23l4.9-1A12 12 0 1012 0zm6.5 17.2c-.3.8-1.7 1.6-2.4 1.6-.6 0-1.4.1-3.8-1-3.2-1.4-5.3-4.6-5.5-4.8-.1-.2-1.3-1.7-1.3-3.2 0-1.6.8-2.4 1.1-2.7.3-.3.7-.4 1-.4h.8c.2 0 .6 0 .9.7.3.8 1.1 2.7 1.2 2.9.1.2.2.5 0 .8-.2.3-.3.5-.6.8-.3.3-.6.6-.2 1.2.4.6 1.7 2.8 4 3.8 2.9 1.2 3 .8 3.5.8.5 0 1.8-.8 2.1-1.5.2-.7 1-1.6 1.3-1.8.2-.1.3-.2.5-.1l1 .5c.3.1.5.3.5.5-.1.4-.7 2-1 2.7z"/></svg>
    </a>
    <!-- تيليغرام -->
    <a class="iconbtn" id="shareTG" title="تيليغرام" target="_blank" aria-label="Telegram">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 18.2l-.3 4.1c.4 0 .6-.2.8-.4l2-1.8 4.1 3c.7.4 1.3.2 1.5-.7L22 6.2c.2-1.1-.4-1.5-1.1-1.2L2.3 11.1c-1.1.4-1 1.3 0 1.6l4.1 1.2 9.4-5.9c.4-.3.9-.1.5.2L9 18.2z"/></svg>
    </a>
    <!-- X -->
    <a class="iconbtn" id="shareX" title="X" target="_blank" aria-label="X">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 2h4.7l5 6.8L18.7 2H22l-7.8 9.1L22 22h-4.8l-5.4-7.2L6 22H2.1l8.3-9.8L3 2z"/></svg>
    </a>
    <!-- فيسبوك -->
    <a class="iconbtn" id="shareFB" title="فيسبوك" target="_blank" aria-label="Facebook">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22 12a10 10 0 10-11.6 9.9v-7H7.7V12h2.7V9.8c0-2.7 1.6-4.2 4-4.2 1.2 0 2.5.2 2.5.2v2.7h-1.4c-1.4 0-1.9.9-1.9 1.8V12h3.2l-.5 2.9h-2.7v7A10 10 0 0022 12z"/></svg>
    </a>
    <!-- نسخ الرابط -->
    <button class="iconbtn" id="copyLink" title="نسخ الرابط" aria-label="Copy Link">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M16 1H8C6.3 1 5 2.3 5 4v12c0 1.7 1.3 3 3 3h8c1.7 0 3-1.3 3-3V4c0-1.7-1.3-3-3-3zm1 15c0 .6-.4 1-1 1H8c-.6 0-1-.4-1-1V4c0-.6.4-1 1-1h8c.6 0 1 .4 1 1v12zM7 20c0 .6.4 1 1 1h8v2H8c-1.7 0-3-1.3-3-3v-2h2v2z"/></svg>
    </button>
  </div>

  <!-- التذييل — نص عادي لكن قابل للنقر -->
  <footer id="devLink">برمجة وتطوير: فاضل الريس</footer>
</main>

<script>
/* ثوابت */
const SOLAR_YEAR=365.2425, LUNAR_YEAR=354.367;

/* عناصر */
const yEl=document.getElementById('y');
const mEl=document.getElementById('m');
const dEl=document.getElementById('d');
const genderSeg=document.getElementById('gender');
const calcBtn=document.getElementById('calc');
const verdict=document.getElementById('verdict');
const kpis=document.getElementById('kpis');
const eqDates=document.getElementById('eqDates');
const rulesDeck=document.getElementById('rules');

/* حالة الجنس */
let gender='girl';

/* إدخال أرقام فقط */
[yEl,mEl,dEl].forEach(inp=>{
  inp.addEventListener('input',()=>{ inp.value = inp.value.replace(/\D+/g,''); });
});

/* تبديل الجنس */
genderSeg.querySelectorAll('button').forEach(b=>{
  b.addEventListener('click',()=>{
    genderSeg.querySelectorAll('button').forEach(x=>x.classList.remove('on'));
    b.classList.add('on');
    gender = b.dataset.g;
  });
});

/* أدوات تاريخ */
function toUTC(d){ return new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate())); }
function daysBetweenUTC(a,b){ return (toUTC(b)-toUTC(a))/(1000*60*60*24); }
function fmtDate(d){
  const y=d.getUTCFullYear(), m=String(d.getUTCMonth()+1).padStart(2,'0'), da=String(d.getUTCDate()).padStart(2,'0');
  return `${y}-${m}-${da}`;
}
function addYMD(base,y,m,day){ return new Date(Date.UTC(base.getUTCFullYear()+y, base.getUTCMonth()+m, base.getUTCDate()+day)); }

/* بطاقة HTML سريعة */
function makeCard(t,b){ const e=document.createElement('div'); e.className='card'; e.innerHTML=`<h3>${t}</h3>${b}`; return e; }

/* بناء الأحكام والبطاقات */
function buildRules(isM){
  rulesDeck.innerHTML='';

  if(gender==='boy'){
    const signsHTML = `
      <p>يُعتبر الصبيّ بالغًا عند تحقّق أحد الأمور الآتية:</p>
      <ul>
        <li>نبات الشعر الخشن في موضع العانة (الموضع بين البطن والعورة).</li>
        <li>خروج المني.</li>
        <li>إتمام خمس عشرة سنة هلالية (≈ أربعة عشر سنة وستة أشهر وخمسة عشر يومًا ميلاديًّا).</li>
        <li>نبات الشعر الخشن في الخدّ أو في الشارب.</li>
      </ul>
      <p style="margin-top:6px">وإذا تحقّقت إحدى هذه العلامات قبل بلوغ الخامسة عشرة قمرية، عُدَّ الصبيّ مُكلَّفًا.</p>
      <p class="muted" style="margin-top:6px;color:#6b7280">أمّا نبات الشعر في الصدر وتحت الإبط، وغلظ الصوت ونظائرها فليست علامات معتبرة للبلوغ.</p>
    `;
    rulesDeck.append(makeCard('علامات البلوغ للصبي', signsHTML));
  }

  if(!isM){
    rulesDeck.append(makeCard('تنبيه','<p>لم يبلغ سنّ التكليف بعد. يُستحسن التعلّم المبدئي للطهارة والصلاة تمهيدًا للالتزام عند البلوغ.</p>'));
    rulesDeck.style.display='grid';
    return;
  }

  const salat=makeCard('الصلاة (واجب)','<p>خمس صلوات يوميًا بشروطها: الطهارة، والوقت، والقبلة، والستر.</p>');
  const siyam=makeCard('الصيام (واجب)','<p>صوم شهر رمضان مع النيّة واجتناب المفطرات، مع مراعاة أحكام الأعذار.</p>');
  const tahara=makeCard('الطهارة (شرط)','<p>وضوء أو غسل بحسب الحال، والتحقّق من طهارة البدن والثوب ومحل السجود.</p>');
  const taqlid=makeCard('التقليد (واجب)','<p>العمل وفق فتوى المرجع الأعلم.</p>');
  const khums=makeCard('الخمس (واجب)','<p>واجب في فاضل المؤونة ونحوها بنهاية السنة الخُمسية.</p>');

  if(gender==='girl'){
    const hijab=makeCard('الحجاب (واجب)','<p>ستر البدن على نحو لا يَصِف البشرة، مع مراعاة حدود النظر والزينة والعفّة.</p>');
    rulesDeck.append(salat,siyam,hijab,tahara,taqlid,khums);
  }else{
    rulesDeck.append(salat,siyam,tahara,taqlid,khums);
  }
  rulesDeck.style.display='grid';
}

/* الحساب الرئيسي */
calcBtn.addEventListener('click',()=>{
  const y=parseInt(yEl.value,10), m=parseInt(mEl.value,10), d=parseInt(dEl.value,10);
  if(!(y>=1900 && y<=2100 && m>=1 && m<=12 && d>=1 && d<=31)){
    alert('تأكّد من إدخال السنة (1900–2100) والشهر (1–12) واليوم (1–31).');
    return;
  }
  const dob=new Date(Date.UTC(y, m-1, d));
  const today=new Date();
  if(dob > today){ alert('تاريخ الميلاد لا يمكن أن يكون في المستقبل.'); return; }

  const days=daysBetweenUTC(dob, today);
  const solarY=days/SOLAR_YEAR;
  const hijriY=days/LUNAR_YEAR;

  // حدّ التكليف القمري
  const hijriThreshold=(gender==='girl')?9:15;

  // المعادل الميلادي التقريبي للسنّين
  const eqGirlDate = addYMD(toUTC(dob), 8, 8, 20); // 8 سنوات + 8 أشهر + 20 يومًا
  const eqBoyDate  = addYMD(toUTC(dob),14, 6, 15); // 14 سنة + 6 أشهر + 15 يومًا

  const isMukallaf = hijriY >= hijriThreshold;

  verdict.style.display='inline-block';
  verdict.className='badge ' + (isMukallaf ? 'ok' : 'no');
  verdict.textContent = isMukallaf ? '✅ تمّ بلوغ سنّ التكليف' : '⏳ لم يبلغ سنّ التكليف بعد';

  kpis.style.display='grid';
  document.getElementById('solarY').textContent = solarY.toFixed(1);
  document.getElementById('hijriY').textContent = hijriY.toFixed(1);
  document.getElementById('threshold').textContent = hijriThreshold + ' قمري';
  document.getElementById('status').textContent = isMukallaf ? 'مكلَّف' : 'غير مكلَّف';

  // التواريخ التقريبية
  eqDates.style.display='grid';
  document.getElementById('eqGirl').textContent = fmtDate(eqGirlDate);
  document.getElementById('eqBoy').textContent  = fmtDate(eqBoyDate);

  // بطاقات الأحكام/العلامات
  buildRules(isMukallaf);
});

/* مشاركة الصفحة */
document.getElementById('shareWA').addEventListener('click', (e)=>{ e.preventDefault(); window.open(`https://wa.me/?text=${encodeURIComponent(location.href)}`,'_blank','noopener'); });
document.getElementById('shareTG').addEventListener('click', (e)=>{ e.preventDefault(); window.open(`https://t.me/share/url?url=${encodeURIComponent(location.href)}`,'_blank','noopener'); });
document.getElementById('shareX').addEventListener('click',  (e)=>{ e.preventDefault(); window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(location.href)}`,'_blank','noopener'); });
document.getElementById('shareFB').addEventListener('click', (e)=>{ e.preventDefault(); window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(location.href)}`,'_blank','noopener'); });
document.getElementById('copyLink').addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(location.href); alert('تمّ نسخ الرابط.'); }catch(_){} });

/* فتح محادثة واتساب عند الضغط على التذييل (من دون إظهاره كرابط) */
document.getElementById('devLink').addEventListener('click', ()=>{
  window.open("https://api.whatsapp.com/send/?phone=97333375858&text&type=phone_number&app_absent=0&wame_ctl=1&fbclid=PAVERDUAMlCr1leHRuA2FlbQIxMAABpwqPFLJG8laAnV5rw6XUJyaPM5Iu46lcNuSytaWagu69EOXocnveCBK9VAGO_aem_jZeAIULAjqXYmbzLyPrU1Q", "_blank", "noopener");
});
</script>
</body>
</html>
