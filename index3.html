<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆÙÙ‚ Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø¬Ø¹ÙØ±ÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@600&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --ink:#0f172a; --muted:#6b7280; --bg:#f6f8fb; --border:#e5e7eb;
    --accent:#0ea5a6; --shadow:0 8px 20px rgba(2,6,23,.08);
    --hadith-color:#0d2a58;
  }
  *{box-sizing:border-box}
  body{margin:0; background:var(--bg); font-family:"Tajawal",sans-serif; color:var(--ink); padding:16px;}
  .container{width:min(1000px,100%); margin:auto; display:flex; flex-direction:column; gap:16px}

  .topClock{text-align:right; font-size:.95rem; font-weight:700; color:#084241}

  .hero{background:#fff; border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); padding:18px; text-align:center}
  .heroTitle{margin:0; font-family:"Reem Kufi",sans-serif; font-size:1.4rem; color:var(--ink)}

  .locationBox{background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:12px 14px; display:flex; justify-content:space-between; align-items:center}
  .place{font-weight:800}
  .changeBtn{background:#eef6ff; border:1px solid var(--border); padding:6px 12px; border-radius:999px; font-weight:800; cursor:pointer}

  .infoRow{display:grid; grid-template-columns:1fr 1fr; gap:16px}
  @media(max-width:720px){.infoRow{grid-template-columns:1fr}}
  .chip{background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:12px; display:flex; align-items:center; gap:12px}
  .ico{width:34px; height:34px; display:grid; place-items:center; border-radius:8px; background:#eef2ff; font-size:1.2rem}
  .stack{display:flex; flex-direction:column}
  .label{font-size:.85rem; color:var(--muted); font-weight:700}
  .value{font-weight:800; font-size:1rem; font-variant-numeric:tabular-nums}

  .card{background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:12px}
  .card h3{margin:0 0 10px; font-size:1rem; font-weight:800}
  table{width:100%; border-collapse:collapse}
  th,td{padding:12px; border-bottom:1px solid #f0f0f0; font-size:1rem}
  th{background:#fafafa; font-weight:800}
  td.name{text-align:right; font-weight:700}
  td.time{text-align:left; font-weight:800}
  tr.next td{background:linear-gradient(90deg,#0ea5a61a,transparent)}

  .events{display:none; background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:14px}
  .events h3{margin:0 0 8px; font-size:1rem; font-weight:800}
  .evtGrid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  @media(max-width:720px){.evtGrid{grid-template-columns:1fr}}
  .evtCol{border:1px dashed #e3e8f0; border-radius:10px; padding:10px}
  .evtCol h4{margin:0 0 6px; font-size:.9rem; color:var(--ink)}
  .evtItem{padding:6px 0; border-bottom:1px solid #f0f0f0}
  .evtItem:last-child{border-bottom:none}
  .evtText{font-weight:700}

  .hadith{background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow); padding:16px; text-align:center}
  .htext{margin:0; font-size:1.06rem; color:var(--hadith-color); line-height:1.9}
  .hsrc{display:inline-block; margin-top:12px; padding:6px 14px; border-radius:10px; background:#f5f7fa; border:1px solid var(--border); font-weight:800; color:#3b4656}

  footer{text-align:center; margin-top:8px}
  .credit{color:var(--hadith-color); font-weight:800}

  .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(15,23,42,.28); z-index:60}
  .modal.open{display:grid}
  .box{width:min(520px,96%); background:#fff; border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); padding:16px}
  .rowCtrl{display:flex; gap:10px; align-items:center; margin:8px 0}
  .rowCtrl label{width:110px; color:var(--muted); font-weight:700}
  select{flex:1; padding:12px; border-radius:12px; border:1px solid var(--border); font-weight:700}
  .actions{display:flex; gap:10px; margin-top:12px}
  .btn{border:1px solid var(--border); border-radius:10px; padding:.55rem .9rem; font-weight:800; cursor:pointer; background:#fff}
  .btn.primary{background:#eef6ff}
</style>
</head>
<body>
  <div class="container">
    <div class="topClock" id="topClock">--:-- --</div>

    <section class="hero">
      <h1 class="heroTitle">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆÙÙ‚ Ø§Ù„Ù…Ø°Ù‡Ø¨ Ø§Ù„Ø¬Ø¹ÙØ±ÙŠ</h1>
    </section>

    <div class="locationBox">
      <div class="place" id="place">Ø§Ù„Ù…Ù†Ø§Ù…Ø©ØŒ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</div>
      <button class="changeBtn" id="openPicker" type="button">ØªØºÙŠÙŠØ±</button>
    </div>

    <section class="infoRow">
      <div class="chip">
        <div class="ico">ğŸ—“</div>
        <div class="stack"><div class="label">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</div><div class="value" id="hijri">--</div></div>
      </div>
      <div class="chip">
        <div class="ico">ğŸ“…</div>
        <div class="stack"><div class="label">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</div><div class="value" id="greg">--</div></div>
      </div>
    </section>

    <section class="card">
      <h3>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
      <table>
        <thead><tr><th>Ø§Ù„Ø­Ø¯Ø«</th><th>Ø§Ù„ÙˆÙ‚Øª</th></tr></thead>
        <tbody id="times"><tr><td colspan="2">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</td></tr></tbody>
      </table>
    </section>

    <section class="events" id="eventsBox">
      <h3>Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
      <div class="evtGrid">
        <div class="evtCol"><h4>Ø§Ù„ÙŠÙˆÙ…</h4><div id="eventsToday"></div></div>
        <div class="evtCol"><h4>Ø§Ù„Ù„ÙŠÙ„Ø©</h4><div id="eventsTonight"></div></div>
      </div>
    </section>

    <section class="hadith">
      <p class="htext" id="hadithText"></p>
      <div class="hsrc" id="hadithSource"></div>
    </section>

    <footer><span class="credit">Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ± ÙØ§Ø¶Ù„ Ø§Ù„Ø±ÙŠØ³</span></footer>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
  <div class="modal" id="modal">
    <div class="box">
      <div class="rowCtrl"><label>Ø§Ù„Ø¨Ù„Ø¯</label><select id="countrySel"></select></div>
      <div class="rowCtrl"><label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><select id="citySel"></select></div>
      <div class="rowCtrl">
        <label>ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ù‡Ø¬Ø±ÙŠ</label>
        <select id="hijriOffsetSel">
          <option value="-2">-2 ÙŠÙˆÙ…</option>
          <option value="-1">-1 ÙŠÙˆÙ…</option>
          <option value="0" selected>Ø¨Ø¯ÙˆÙ† ØªØ¹ÙˆÙŠØ¶</option>
          <option value="1">+1 ÙŠÙˆÙ…</option>
          <option value="2">+2 ÙŠÙˆÙ…</option>
        </select>
      </div>
      <div class="actions">
        <button class="btn primary" id="savePlace" type="button">Ø­ÙØ¸</button>
        <button class="btn" id="cancelPlace" type="button">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

<script>
/* ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù„Ø¯Ø§Ù† ÙˆØ§Ù„Ù…Ø¯Ù† ===== */
const MAP=[
 {ar:"Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†",en:"Bahrain",tz:"Asia/Bahrain",cities:[
   {ar:"Ø§Ù„Ù…Ù†Ø§Ù…Ø©",en:"Manama"},{ar:"Ø§Ù„Ù…Ø­Ø±Ù‚",en:"Muharraq"},{ar:"Ù…Ø¯ÙŠÙ†Ø© Ø¹ÙŠØ³Ù‰",en:"Isa Town"},
   {ar:"Ù…Ø¯ÙŠÙ†Ø© Ø­Ù…Ø¯",en:"Hamad Town"},{ar:"Ø³ØªØ±Ø©",en:"Sitra"},{ar:"Ø³Ø§Ø±",en:"Saar"},
   {ar:"Ø§Ù„Ø¯Ø±Ø§Ø²",en:"Draz"},{ar:"Ø¬Ø¯Ø­ÙØµ",en:"Jidhafs"}
 ]},
 {ar:"Ù„Ø¨Ù†Ø§Ù†",en:"Lebanon",tz:"Asia/Beirut",cities:[{ar:"Ø¨ÙŠØ±ÙˆØª",en:"Beirut"},{ar:"Ø·Ø±Ø§Ø¨Ù„Ø³",en:"Tripoli"},{ar:"ØµÙŠØ¯Ø§",en:"Sidon"}]},
 {ar:"Ø§Ù„Ø¹Ø±Ø§Ù‚",en:"Iraq",tz:"Asia/Baghdad",cities:[{ar:"Ø¨ØºØ¯Ø§Ø¯",en:"Baghdad"},{ar:"Ø§Ù„Ø¨ØµØ±Ø©",en:"Basrah"},{ar:"Ø£Ø±Ø¨ÙŠÙ„",en:"Erbil"}]},
 {ar:"Ø¥ÙŠØ±Ø§Ù†",en:"Iran",tz:"Asia/Tehran",cities:[{ar:"Ø·Ù‡Ø±Ø§Ù†",en:"Tehran"},{ar:"Ù…Ø´Ù‡Ø¯",en:"Mashhad"},{ar:"Ø£ØµÙÙ‡Ø§Ù†",en:"Isfahan"}]},
 {ar:"Ø§Ù„ÙƒÙˆÙŠØª",en:"Kuwait",tz:"Asia/Kuwait",cities:[{ar:"Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ÙƒÙˆÙŠØª",en:"Kuwait City"},{ar:"Ø­ÙˆÙ„ÙŠ",en:"Hawalli"},{ar:"Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ",en:"Al Ahmadi"}]},
 {ar:"Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©",en:"Saudi Arabia",tz:"Asia/Riyadh",cities:[
   {ar:"Ø§Ù„Ø±ÙŠØ§Ø¶",en:"Riyadh"},{ar:"Ø¬Ø¯Ø©",en:"Jeddah"},{ar:"Ø§Ù„Ø¯Ù…Ø§Ù…",en:"Dammam"},{ar:"Ù…ÙƒØ©",en:"Mecca"},{ar:"Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",en:"Medina"}]}
];

const DEFAULT={countryEn:"Bahrain",countryAr:"Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†",cityEn:"Manama",cityAr:"Ø§Ù„Ù…Ù†Ø§Ù…Ø©",tz:"Asia/Bahrain"};
let current = JSON.parse(localStorage.getItem("jaq_prayer_place")||"null") || {...DEFAULT};
let HIJRI_OFFSET_DAYS = Number(localStorage.getItem("jaq_hijri_offset_days")||"0");

/* Ù…ØµØ¯Ø± Ù‡Ø¬Ø±ÙŠ Ø®Ø§Ø±Ø¬ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€” Ø§ØªØ±ÙƒÙ‡ null Ø¥Ù† Ù„Ù… ÙŠÙƒÙ† Ù„Ø¯ÙŠÙƒ Ù…ØµØ¯Ø± */
const HIJRI_SOURCE_URL = null;

/* Ø£Ø­Ø§Ø¯ÙŠØ« */
const HADITHS=[
  {t:"Ù‚Ø§Ù„ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø¨Ø§Ù‚Ø± (Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…): Ø¥Ø°Ø§ Ø§Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ù…ØµÙ„ÙŠ Ø§Ù„Ù‚Ø¨Ù„Ø© Ø§Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø±Ø­Ù…Ù† Ø¨ÙˆØ¬Ù‡Ù‡ Ù„Ø§ Ø¥Ù„Ù‡ ØºÙŠØ±Ù‡.",s:"Ø§Ù„Ù…ØµØ¯Ø±: Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø­ÙƒÙ…Ø©"},
  {t:"Ù‚Ø§Ù„ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…): Ø¥Ø°Ø§ Ù‚Ø§Ù… Ø§Ù„Ø±Ø¬Ù„ Ø¥Ù„Ù‰ Ø§Ù„ØµÙ„Ø§Ø© Ø£Ù‚Ø¨Ù„ Ø¥Ø¨Ù„ÙŠØ³ ÙŠÙ†Ø¸Ø± Ø¥Ù„ÙŠÙ‡ Ø­Ø³Ø¯Ø§Ù‹ Ù„Ù…Ø§ ÙŠØ±Ù‰ Ù…Ù† Ø±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ Ø§Ù„ØªÙŠ ØªØºØ´Ø§Ù‡.",s:"Ø§Ù„Ù…ØµØ¯Ø±: Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø­ÙƒÙ…Ø©"},
  {t:"Ù‚Ø§Ù„ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø±Ø¶Ø§ (Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…): Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù‡Ø§ Ø£Ø±Ø¨Ø¹Ø© Ø¢Ù„Ø§Ù Ø¨Ø§Ø¨.",s:"Ø§Ù„Ù…ØµØ¯Ø±: Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø­ÙƒÙ…Ø©"},
  {t:"Ù‚Ø§Ù„ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…): ÙŠØ§ ÙƒÙ…ÙŠÙ„! Ù„ÙŠØ³ Ø§Ù„Ø´Ø£Ù† Ø£Ù† ØªØµÙ„ÙŠ ÙˆØªØµÙˆÙ… ÙˆØªØªØµØ¯Ù‚ØŒ Ø¥Ù†Ù…Ø§ Ø§Ù„Ø´Ø£Ù† Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ØµÙ„Ø§Ø© ÙØ¹Ù„Øª Ø¨Ù‚Ù„Ø¨ Ù†Ù‚ÙŠØŒ ÙˆØ¹Ù…Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù‡ Ù…Ø±Ø¶ÙŠØŒ ÙˆØ®Ø´ÙˆØ¹ Ø³ÙˆÙŠ.",s:"Ø§Ù„Ù…ØµØ¯Ø±: Ù…ÙŠØ²Ø§Ù† Ø§Ù„Ø­ÙƒÙ…Ø©"},
  {t:"Ø¹Ù† Ø³Ø¹Ø¯ Ø¨Ù† Ø£Ø¨ÙŠ ÙˆÙ‚Ø§Øµ: Ø³Ø£Ù„Øª Ø§Ù„Ù†Ø¨ÙŠ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ¢Ù„Ù‡ Ø¹Ù† Ù‚ÙˆÙ„Ù‡: Ø§Ù„Ø°ÙŠÙ† Ù‡Ù… Ø¹Ù† ØµÙ„Ø§ØªÙ‡Ù… Ø³Ø§Ù‡ÙˆÙ†. Ù‚Ø§Ù„: Ù‡Ù… Ø§Ù„Ø°ÙŠÙ† ÙŠØ¤Ø®Ø±ÙˆÙ† Ø§Ù„ØµÙ„Ø§Ø© Ø¹Ù† ÙˆÙ‚ØªÙ‡Ø§.",s:"Ø§Ù„Ù…ØµØ¯Ø±: Ø§Ù„Ø³Ù†Ù† Ø§Ù„ÙƒØ¨Ø±Ù‰"},
  {t:"Ù‚Ø§Ù„ Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ¢Ù„Ù‡: Ù…Ù† ØªØ±Ùƒ ØµÙ„Ø§ØªÙ‡ Ù…ØªØ¹Ù…Ø¯Ø§Ù‹ ÙÙ‚Ø¯ Ù‡Ø¯Ù… Ø¯ÙŠÙ†Ù‡ØŒ ÙˆÙ…Ù† ØªØ±Ùƒ Ø£ÙˆÙ‚Ø§ØªÙ‡Ø§ ÙŠØ¯Ø®Ù„ Ø§Ù„ÙˆÙŠÙ„ØŒ ÙˆØ§Ù„ÙˆÙŠÙ„ ÙˆØ§Ø¯Ù ÙÙŠ Ø¬Ù‡Ù†Ù… ÙƒÙ…Ø§ Ù‚Ø§Ù„ ØªØ¹Ø§Ù„Ù‰: ÙÙˆÙŠÙ„ Ù„Ù„Ù…ØµÙ„ÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ù‡Ù… Ø¹Ù† ØµÙ„Ø§ØªÙ‡Ù… Ø³Ø§Ù‡ÙˆÙ†.",s:"Ø§Ù„Ù…ØµØ¯Ø±: Ø¬Ø§Ù…Ø¹ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±"},
  {t:"Ù‚Ø§Ù„ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¨Ù† Ù…Ø³Ø¹ÙˆØ¯: Ø³Ø£Ù„Øª Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ¢Ù„Ù‡: Ø£ÙŠÙ‘ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø£Ø­Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡ Ø¬Ù„ Ø¬Ù„Ø§Ù„Ù‡ØŸ Ù‚Ø§Ù„: Ø§Ù„ØµÙ„Ø§Ø© Ù„ÙˆÙ‚ØªÙ‡Ø§.",s:"Ø§Ù„Ù…ØµØ¯Ø±: Ø§Ù„Ø®ØµØ§Ù„"}
];
function setHadith(){
  const h=HADITHS[Math.floor(Math.random()*HADITHS.length)];
  hadithText.textContent=h.t; hadithSource.textContent=h.s;
}

/* Ù…Ù†Ø§Ø³Ø¨Ø§Øª (Ù…ÙØªØ§Ø­ m-d Ù‡Ø¬Ø±ÙŠ) */
const EVENTS={
  "1-1":[{t:"Ø±Ø£Ø³ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù‡Ø¬Ø±ÙŠØ©"}],
  "1-2":[{t:"Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³ÙŠÙ† Ø¹ ÙƒØ±Ø¨Ù„Ø§Ø¡"}],
  "1-7":[{t:"Ø¨Ø¯Ø¡ Ù…Ù†Ø¹ Ø§Ù„Ù…Ø§Ø¡ Ø¹Ù† Ø®ÙŠØ§Ù… Ø§Ù„Ø­Ø³ÙŠÙ† Ø¹"}],
  "1-9":[{t:"ØªØ§Ø³ÙˆØ¹Ø§Ø¡ â€“ ÙŠÙˆÙ… Ø£Ø¨ÙŠ Ø§Ù„ÙØ¶Ù„ Ø§Ù„Ø¹Ø¨Ø§Ø³ Ø¹"}],
  "1-10":[{t:"Ø¹Ø§Ø´ÙˆØ±Ø§Ø¡ â€“ Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³ÙŠÙ† Ø¹ ÙˆØ£Ù‡Ù„ Ø¨ÙŠØªÙ‡ ÙˆØ£ØµØ­Ø§Ø¨Ù‡"}],
  "2-7":[{t:"(Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ù‚ÙˆØ§Ù„) Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³Ù† Ø§Ù„Ù…Ø¬ØªØ¨Ù‰ Ø¹"}],
  "2-20":[{t:"Ø§Ù„Ø£Ø±Ø¨Ø¹ÙŠÙ† â€“ Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³ÙŠÙ† Ø¹"}],
  "2-28":[{t:"ÙˆÙØ§Ø© Ø§Ù„Ù†Ø¨ÙŠ Ø§Ù„Ø£ÙƒØ±Ù… ï·º Ø¹Ù†Ø¯ Ø§Ù„Ø´ÙŠØ¹Ø©"},{t:"Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³Ù† Ø§Ù„Ù…Ø¬ØªØ¨Ù‰ Ø¹"}],
  "3-8":[{t:"Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³Ù† Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø¹"}],
  "3-9":[{t:"ÙØ±Ø­Ø© Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡ (Ø¹ÙŠØ¯ Ø§Ù„Ø¨ÙÙ‚Ø±)"}],
  "3-17":[{t:"Ø§Ù„Ù…ÙˆÙ„Ø¯ Ø§Ù„Ù†Ø¨ÙˆÙŠ Ø§Ù„Ø´Ø±ÙŠÙ (Ø¹Ù†Ø¯ Ø§Ù„Ø´ÙŠØ¹Ø©)"}],
  "4-8":[{t:"(Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ù‚ÙˆØ§Ù„) ÙˆÙ„Ø§Ø¯Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³Ù† Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø¹"}],
  "4-10":[{t:"(Ø£Ù‚ÙˆØ§Ù„) ÙˆÙ„Ø§Ø¯Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³Ù† Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø¹"}],
  "5-5":[{t:"Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø³ÙŠØ¯Ø© Ø²ÙŠÙ†Ø¨ Ø¨Ù†Øª Ø¹Ù„ÙŠ Ø¹"}],
  "5-13":[{t:"(Ù‚ÙˆÙ„) Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø³ÙŠØ¯Ø© ÙØ§Ø·Ù…Ø© Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡ Ø¹"}],
  "6-3":[{t:"Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø³ÙŠØ¯Ø© ÙØ§Ø·Ù…Ø© Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡ Ø¹ (Ù‚ÙˆÙ„ Ù…Ø´Ù‡ÙˆØ±)"}],
  "6-20":[{t:"Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø³ÙŠØ¯Ø© ÙØ§Ø·Ù…Ø© Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡ Ø¹"}],
  "7-1":[{t:"Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¨Ø§Ù‚Ø± Ø¹"}],
  "7-3":[{t:"Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ Ø§Ù„Ù‡Ø§Ø¯ÙŠ Ø¹"}],
  "7-10":[{t:"Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬ÙˆØ§Ø¯ Ø¹"}],
  "7-13":[{t:"Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ Ø¨Ù† Ø£Ø¨ÙŠ Ø·Ø§Ù„Ø¨ Ø¹"}],
  "7-25":[{t:"Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ù…ÙˆØ³Ù‰ Ø§Ù„ÙƒØ§Ø¸Ù… Ø¹"}],
  "7-27":[{t:"Ø§Ù„Ù…Ø¨Ø¹Ø« Ø§Ù„Ù†Ø¨ÙˆÙŠ"}],
  "8-3":[{t:"Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³ÙŠÙ† Ø¹"}],
  "8-4":[{t:"Ù…ÙˆÙ„Ø¯ Ø£Ø¨ÙŠ Ø§Ù„ÙØ¶Ù„ Ø§Ù„Ø¹Ø¨Ø§Ø³ Ø¹"}],
  "8-5":[{t:"Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø²ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¨Ø¯ÙŠÙ† Ø¹"}],
  "8-15":[{t:"Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ù…Ù‡Ø¯ÙŠ Ø¹Ø¬Ù„ Ø§Ù„Ù„Ù‡ ÙØ±Ø¬Ù‡"}],
  "9-15":[{t:"Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³Ù† Ø§Ù„Ù…Ø¬ØªØ¨Ù‰ Ø¹"}],
  "9-19":[{t:"Ø¶Ø±Ø¨Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ Ø¹ â€“ Ù„ÙŠÙ„Ø© Ù‚Ø¯Ø±"}],
  "9-21":[{t:"Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ Ø¹ â€“ Ù„ÙŠÙ„Ø© Ù‚Ø¯Ø±"}],
  "9-23":[{t:"Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø¯Ø± (Ù‚ÙˆÙ„ Ù…Ø´Ù‡ÙˆØ±)"}],
  "10-1":[{t:"Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø± Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ"}],
  "11-11":[{t:"Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ Ø¨Ù† Ù…ÙˆØ³Ù‰ Ø§Ù„Ø±Ø¶Ø§ Ø¹"}],
  "11-23":[{t:"Ø¯Ø­Ùˆ Ø§Ù„Ø£Ø±Ø¶"}],
  "12-7":[{t:"ÙŠÙˆÙ… Ø§Ù„ØªØ±ÙˆÙŠØ©"}],
  "12-9":[{t:"ÙŠÙˆÙ… Ø¹Ø±ÙØ© (ÙˆØ´Ù‡Ø§Ø¯Ø© Ù…Ø³Ù„Ù… Ø¨Ù† Ø¹Ù‚ÙŠÙ„ Ø¹ Ø¹Ù†Ø¯ Ø¨Ø¹Ø¶ Ø§Ù„Ø±ÙˆØ§ÙŠØ§Øª)"}],
  "12-10":[{t:"Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰ Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ"}],
  "12-18":[{t:"Ø¹ÙŠØ¯ Ø§Ù„ØºØ¯ÙŠØ± Ø§Ù„Ø£ØºØ±"}],
  "12-24":[{t:"ÙŠÙˆÙ… Ø§Ù„Ù…Ø¨Ø§Ù‡Ù„Ø©"}],
  "12-25":[{t:"ÙŠÙˆÙ… Ù†Ø²ÙˆÙ„ Ø³ÙˆØ±Ø© Ø§Ù„Ø¥Ù†Ø³Ø§Ù†"}]
};

/* ===== ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ===== */
function to12h(raw){
  if(!raw) return "--:-- --";
  const pure=String(raw).replace(/\s*\(.*?\)\s*/g,"");
  const [H,M]=pure.split(":").map(Number); if(Number.isNaN(H)||Number.isNaN(M)) return raw;
  let h=H%12||12; return `${h}:${String(M).padStart(2,"0")} ${H<12?"AM":"PM"}`;
}
function updateClock(){
  topClock.textContent=new Intl.DateTimeFormat('en-GB',{timeZone:current.tz,hour:'2-digit',minute:'2-digit',hour12:true}).format(new Date());
}
function fmtGreg(){
  return new Intl.DateTimeFormat('ar',{timeZone:current.tz,weekday:'long',year:'numeric',month:'long',day:'numeric'}).format(new Date());
}
function hijriYMD(d){
  const parts=new Intl.DateTimeFormat('en-TN-u-ca-islamic',{timeZone:current.tz,year:'numeric',month:'numeric',day:'numeric'}).formatToParts(d);
  return {y:+parts.find(p=>p.type==='year').value, m:+parts.find(p=>p.type==='month').value, d:+parts.find(p=>p.type==='day').value};
}

/* Ù…Ø³Ø§Ø¹Ø¯ Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ù…ÙØ§ØªÙŠØ­ Ø¨Ø£Ø³Ù…Ø§Ø¡ Ù…Ø®ØªÙ„ÙØ© */
function pick(obj, keys){
  for (const k of keys){
    if (obj && Object.prototype.hasOwnProperty.call(obj, k) && obj[k] != null && obj[k] !== "")
      return obj[k];
  }
  return undefined;
}
const HIJRI_MONTHS_AR=["","Ù…Ø­Ø±Ù…","ØµÙØ±","Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„","Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø¢Ø®Ø±","Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø£ÙˆÙ„Ù‰","Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø¢Ø®Ø±Ø©","Ø±Ø¬Ø¨","Ø´Ø¹Ø¨Ø§Ù†","Ø±Ù…Ø¶Ø§Ù†","Ø´ÙˆØ§Ù„","Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©","Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©"];

/* Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ù…Ù† Ù…ØµØ¯Ø± Ø®Ø§Ø±Ø¬ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) */
async function fetchHijriFromSource(){
  if (!HIJRI_SOURCE_URL) return null;
  try{
    const r = await fetch(HIJRI_SOURCE_URL, {cache:"no-store"});
    if(!r.ok) throw new Error("HTTP "+r.status);
    const j = await r.json();

    const hijriObj = pick(j, ["hijri","Hijri","Ø§Ù„Ù‡Ø¬Ø±ÙŠ"]) || j;
    const y = Number(pick(hijriObj, ["year","Year","y","hijriYear","HijriYear","Ø§Ù„Ù‡Ø¬Ø±ÙŠ_Ø³Ù†Ø©"]));
    let  m = pick(hijriObj, ["month","Month","m","hijriMonth","HijriMonth","Ø§Ù„Ù‡Ø¬Ø±ÙŠ_Ø´Ù‡Ø±"]);
    const d = Number(pick(hijriObj, ["day","Day","d","hijriDay","HijriDay","Ø§Ù„Ù‡Ø¬Ø±ÙŠ_ÙŠÙˆÙ…"]));

    if (typeof m === "string"){
      const idx = HIJRI_MONTHS_AR.findIndex(n => n === m.trim());
      if (idx > 0) m = idx;
    }
    m = Number(m);

    if (!y || !m || !d) return null;

    const weekday = new Intl.DateTimeFormat('ar',{timeZone:current.tz,weekday:'long'}).format(new Date());
    const monthName = HIJRI_MONTHS_AR[m] || String(m);
    return `${weekday}ØŒ ${d} ${monthName} ${y} Ù‡Ù€`;
  }catch(e){
    return null;
  }
}

/* ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø¯Ø«/Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù‚Ø§Ø¯Ù… Ù„ØªØ¸Ù„ÙŠÙ„ Ø§Ù„ØµÙ */
function nextKey(t, tz){
  const order=["Imsak","Fajr","Sunrise","Dhuhr","Asr","Sunset","Maghrib","Isha","Midnight"];
  const nowTZ=new Date(new Date().toLocaleString('en-US',{timeZone:tz}));
  const ds=new Intl.DateTimeFormat('en-CA',{timeZone:tz,year:'numeric',month:'2-digit',day:'2-digit'}).format(nowTZ).split('-').map(Number);
  const [Y,M,D]=ds;
  const cand=order.map(k=>{
    const raw=(t[k]||"").replace(/\s*\(.*?\)\s*/g,"");
    if(!raw.includes(':')) return {k,diff:Infinity};
    const [HH,MM]=raw.split(':').map(Number);
    return {k,diff:new Date(Y,M-1,D,HH||0,MM||0,0)-nowTZ};
  });
  let n=cand.filter(x=>x.diff>=0).sort((a,b)=>a.diff-b.diff)[0];
  if(!n) n=cand.sort((a,b)=>Math.abs(a.diff)-Math.abs(b.diff))[0];
  return n?.k||null;
}

/* Ø¨Ù†Ø§Ø¡ ØµÙ Ø¬Ø¯ÙˆÙ„ */
function tr(name,val,next=false){return `<tr class="${next?'next':''}"><td class="name">${name}</td><td class="time">${to12h(val||'')}</td></tr>`;}

/* ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ Ø¥Ù† Ù„Ù… ÙŠÙ‚Ø¯Ù‘ÙÙ… */
function ensureImsak(t){
  if(!t.Imsak && t.Fajr){
    const [H,M]=String(t.Fajr).replace(/\s*\(.*?\)\s*/g,"").split(":").map(Number);
    const d=new Date(); d.setHours(H||0, (M||0)-10, 0, 0);
    t.Imsak = `${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
  }
  return t;
}

/* Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª (method=0 Ø¬Ø¹ÙØ±ÙŠ) */
async function fetchTimings(countryEn, cityEn){
  const url=`https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(cityEn)}&country=${encodeURIComponent(countryEn)}&method=0`;
  const r=await fetch(url); if(!r.ok) throw new Error("ØªØ¹Ø°Ù‘Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª"); const j=await r.json();
  return j.data.timings;
}

/* ÙŠØ¨Ø¯Ø£ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù…ØºØ±Ø¨ + ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹ÙˆÙŠØ¶ Ø§Ù„ÙŠØ¯ÙˆÙŠ */
function getHijriDateString(){
  const nowTZ = new Date(new Date().toLocaleString('en-US',{timeZone:current.tz}));
  let base = new Date(nowTZ);

  if(lastTimings?.Maghrib){
    const [H,M] = lastTimings.Maghrib.replace(/\s*\(.*?\)\s*/g,"").split(":").map(Number);
    const magh = new Date(nowTZ); magh.setHours(H||0,M||0,0,0);
    if(nowTZ >= magh) base = new Date(nowTZ.getTime() + 24*60*60*1000);
  }
  if(HIJRI_OFFSET_DAYS){
    base = new Date(base.getTime() + HIJRI_OFFSET_DAYS*24*60*60*1000);
  }

  try{
    return new Intl.DateTimeFormat('ar-SA-u-ca-islamic',{timeZone:current.tz,weekday:'long',year:'numeric',month:'long',day:'numeric'}).format(base);
  }catch{
    return "Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ (ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…)";
  }
}

/* Ø¥Ø±Ø¬Ø§Ø¹ (y,m,d) Ù‡Ø¬Ø±ÙŠ Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø¨Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø£Ø¹Ù„Ù‰ */
function hijriYMD_byCustom(dateLike){
  const nowOrGiven = new Date(dateLike);
  let base = nowOrGiven;

  if(lastTimings?.Maghrib){
    const ref = new Date(new Date().toLocaleString('en-US',{timeZone:current.tz}));
    const [H,M] = lastTimings.Maghrib.replace(/\s*\(.*?\)\s*/g,"").split(":").map(Number);
    const magh = new Date(ref); magh.setHours(H||0,M||0,0,0);
    base = (ref >= magh) ? new Date(ref.getTime() + 24*60*60*1000) : ref;
  }
  if(HIJRI_OFFSET_DAYS){
    base = new Date(base.getTime() + HIJRI_OFFSET_DAYS*24*60*60*1000);
  }

  const parts=new Intl.DateTimeFormat('en-TN-u-ca-islamic',{timeZone:current.tz,year:'numeric',month:'numeric',day:'numeric'}).formatToParts(base);
  return {y:+parts.find(p=>p.type==='year').value, m:+parts.find(p=>p.type==='month').value, d:+parts.find(p=>p.type==='day').value};
}

/* Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ + Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª (Async Ù„Ø§Ø­ØªÙ…Ø§Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ù…Ù† Ù…ØµØ¯Ø± Ø®Ø§Ø±Ø¬ÙŠ) */
let lastTimings=null;
async function renderTimes(t, tz){
  const timings=ensureImsak({...t}); 
  lastTimings=timings;

  const rows=[
    {n:"Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ",k:"Imsak"},
    {n:"Ø£Ø°Ø§Ù† Ø§Ù„ÙØ¬Ø±",k:"Fajr"},
    {n:"Ø§Ù„Ø´Ø±ÙˆÙ‚",k:"Sunrise"},
    {n:"Ø£Ø°Ø§Ù† Ø§Ù„Ø¸Ù‡Ø±",k:"Dhuhr"},
    {n:"Ø£Ø°Ø§Ù† Ø§Ù„Ø¹ØµØ±",k:"Asr"},
    {n:"Ø§Ù„ØºØ±ÙˆØ¨",k:"Sunset"},
    {n:"Ø£Ø°Ø§Ù† Ø§Ù„Ù…ØºØ±Ø¨",k:"Maghrib"},
    {n:"Ø£Ø°Ø§Ù† Ø§Ù„Ø¹Ø´Ø§Ø¡",k:"Isha"},
    {n:"Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„",k:"Midnight"}
  ];
  const k=nextKey(timings,tz);
  times.innerHTML=rows.map(r=>tr(r.n,timings[r.k],r.k===k)).join("");

  // Ø£ÙˆÙ„ÙˆÙŠØ©: Ù…ØµØ¯Ø± Ù‡Ø¬Ø±ÙŠ Ø®Ø§Ø±Ø¬ÙŠ (Ø¥Ù† ÙˆÙØ¬Ø¯) Ø«Ù… Ù…Ù†Ø·Ù‚ Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ù…ØºØ±Ø¨ + Ø§Ù„ØªØ¹ÙˆÙŠØ¶
  const hijriFromSource = await fetchHijriFromSource();
  hijri.textContent = hijriFromSource || getHijriDateString();

  renderEvents();
}

/* Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…/Ø§Ù„Ù„ÙŠÙ„Ø© */
function eventsForHijri(hm, hd){ return EVENTS[`${hm}-${hd}`] || []; }
function renderEvents(){
  const nowTZ=new Date(new Date().toLocaleString('en-US',{timeZone:current.tz}));

  const {m:tm,d:td}=hijriYMD_byCustom(nowTZ);                               // Ø§Ù„ÙŠÙˆÙ…
  const {m:nm,d:nd}=hijriYMD_byCustom(new Date(nowTZ.getTime()+24*60*60*1000)); // Ø§Ù„Ù„ÙŠÙ„Ø©

  const todayList=eventsForHijri(tm,td);
  const nightList=eventsForHijri(nm,nd);

  const box=document.getElementById('eventsBox');
  const todayEl=document.getElementById('eventsToday');
  const nightEl=document.getElementById('eventsTonight');

  if(todayList.length===0 && nightList.length===0){ box.style.display='none'; return; }
  box.style.display='block';

  const itemHTML=(e)=>`<div class="evtItem"><span class="evtText">${e.t}</span></div>`;
  todayEl.innerHTML = todayList.length ? todayList.map(itemHTML).join("") : `<div class="evtItem"><span class="evtText">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§Ø³Ø¨Ø©.</span></div>`;
  nightEl.innerHTML = nightList.length ? nightList.map(itemHTML).join("") : `<div class="evtItem"><span class="evtText">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§Ø³Ø¨Ø©.</span></div>`;
}

/* ØªØ­Ù…ÙŠÙ„ Ø¹Ø§Ù… */
async function load(){
  place.textContent=`${current.cityAr}ØŒ ${current.countryAr}`;
  greg.textContent=fmtGreg();
  hijri.textContent="--";
  times.innerHTML="<tr><td colspan=2>...</td></tr>";
  try{
    const t=await fetchTimings(current.countryEn,current.cityEn);
    await renderTimes(t,current.tz);
  }catch{
    times.innerHTML=`<tr><td colspan="2" style="color:#b91c1c">ØªØ¹Ø°Ù‘Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª.</td></tr>`;
    document.getElementById('eventsBox').style.display='none';
    try{
      hijri.textContent=new Intl.DateTimeFormat('ar-SA-u-ca-islamic',{timeZone:current.tz,weekday:'long',year:'numeric',month:'long',day:'numeric'}).format(new Date());
    }catch{ hijri.textContent="Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ (ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…)"; }
  }
}

/* Ø³Ø§Ø¹Ø© + Ø­Ø¯ÙŠØ« */
setInterval(updateClock,1000); updateClock();
setHadith();

/* ===== Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ ===== */
const modal=document.getElementById("modal");
const openPicker=document.getElementById("openPicker");
const cancelPlace=document.getElementById("cancelPlace");
const savePlace=document.getElementById("savePlace");
const countrySel=document.getElementById("countrySel");
const citySel=document.getElementById("citySel");
const hijriOffsetSel=document.getElementById("hijriOffsetSel");

function populateCities(countryEn){
  const c=MAP.find(x=>x.en===countryEn);
  citySel.innerHTML=(c?.cities||[]).map(m=>`<option value="${m.en}">${m.ar}</option>`).join("");
}
function openModal(){
  countrySel.innerHTML=MAP.map(c=>`<option value="${c.en}">${c.ar}</option>`).join("");
  countrySel.value=current.countryEn;
  populateCities(countrySel.value);
  citySel.value=current.cityEn;
  hijriOffsetSel.value=String(HIJRI_OFFSET_DAYS);
  modal.classList.add("open");
  document.body.style.overflow='hidden';
}
function closeModal(){
  modal.classList.remove("open");
  document.body.style.overflow='';
}

openPicker.addEventListener("click",openModal);
cancelPlace.addEventListener("click",closeModal);
modal.addEventListener("click",(e)=>{ if(e.target===modal) closeModal(); });
countrySel.addEventListener("change",()=>populateCities(countrySel.value));
savePlace.addEventListener("click",()=>{
  const c=MAP.find(x=>x.en===countrySel.value);
  const m=(c?.cities||[]).find(x=>x.en===citySel.value);
  if(c&&m){
    current={countryEn:c.en,countryAr:c.ar,cityEn:m.en,cityAr:m.ar,tz:c.tz};
    localStorage.setItem("jaq_prayer_place",JSON.stringify(current));
  }
  HIJRI_OFFSET_DAYS = Number(hijriOffsetSel.value||"0");
  localStorage.setItem("jaq_hijri_offset_days", String(HIJRI_OFFSET_DAYS));
  closeModal();
  load();
});

/* Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ */
load();
</script>
</body>
</html>
