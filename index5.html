<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>الخِيرة بالقرآن | استخارة من الصفحة اليمنى</title>
<meta name="description" content="الخِيرة بالقرآن: استخارة من الصفحة اليمنى (السطر الأول) مع عرض رقم الصفحة، السورة والآية، ونص الآية والنتيجة. بحث برقم الصفحة أو كلمات أو السورة والآية.">
<meta name="keywords" content="استخارة, الخيرة, الخيرة بالقرآن, استخارة بالقرآن, صفحة يمين, السطر الأول, فاضل الريس">
<link rel="canonical" href="https://example.com/">
<meta name="robots" content="index,follow">
<meta property="og:type" content="website">
<meta property="og:locale" content="ar_AR">
<meta property="og:title" content="الخِيرة بالقرآن | استخارة بالقرآن الكريم">
<meta property="og:description" content="استخارة دقيقة من الصفحة اليمنى (السطر الأول) مع نتائج مرتبة وإمكانيات بحث.">
<meta property="og:url" content="https://example.com/">
<meta property="og:site_name" content="الخِيرة بالقرآن">
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@600;700;800&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
<noscript><style>section.view{display:block!important}</style></noscript>
<style>
:root{
  --gold1:#fff4cc; --gold2:#f6d478; --gold3:#e9b84f; --gold4:#cf9a38;
  --ink:#111; --radius:22px;
  --sh-md:0 10px 22px rgba(0,0,0,.14); --sh-xl:0 20px 44px rgba(0,0,0,.22);
  --fs-h1:clamp(26px,4.2vw,44px);
  --fs-h2:clamp(20px,2.8vw,32px);
  --fs-btn:clamp(15px,1.7vw,18px);
  --fs-body:clamp(14px,1.3vw,18px);
  --fs-ayah:clamp(20px,2.2vw,30px);
  --space:clamp(12px,2vw,22px);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;color:var(--ink);font-size:var(--fs-body);
  background:
    radial-gradient(1200px 420px at 50% -120px, rgba(0,0,0,.28), transparent 60%),
    linear-gradient(180deg,#1a1a1a 0%, #0e0e0e 20%, #000 22%),
    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="260" height="260" viewBox="0 0 260 260"><path d="M130 10l120 120-120 120L10 130z" fill="%23f2ead1" fill-opacity=".25"/></svg>') repeat;
  background-blend-mode:soft-light,normal,soft-light;
  font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
}
.container{width:min(1200px,96%);margin-inline:auto;padding:clamp(16px,2.5vw,28px) 0 36px}
.medallion{
  width:clamp(70px,9vw,110px);height:clamp(70px,9vw,110px);
  margin:0 auto calc(var(--space)*-1.3);
  position:relative;z-index:2;border-radius:50%;
  background:
    radial-gradient(circle at 38% 28%, rgba(255,255,255,.5), transparent 40%),
    conic-gradient(from 210deg, var(--gold1), var(--gold2), var(--gold3), var(--gold4), var(--gold2));
  box-shadow:var(--sh-xl), inset 0 0 0 4px rgba(255,255,255,.35), inset 0 0 0 1px rgba(185,130,31,.45)
}
.medallion:after{
  content:"";position:absolute;inset:12px;border-radius:50%;
  background:radial-gradient(circle at 60% 30%, rgba(255,255,255,.55), transparent 45%),linear-gradient(180deg,var(--gold2),var(--gold4));
  box-shadow:inset 0 0 0 1px rgba(185,130,31,.55)
}
.hero{
  position:relative;padding:calc(var(--space)*1.8) var(--space) calc(var(--space)*1.2);
  border-radius:var(--radius);
  background:radial-gradient(120% 180% at 50% -70%, rgba(255,255,255,.18), transparent 70%),
             linear-gradient(180deg,#141414 0%, #0c0c0c 55%, #070707 100%);
  color:#fff;box-shadow:var(--sh-xl);overflow:hidden;text-align:center
}
.title{font-family:"Noto Kufi Arabic";font-weight:800;font-size:var(--fs-h1);margin:0 0 6px}
.divider{
  width:min(240px,40%);height:16px;margin:12px auto 0;border-radius:999px;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,.35), transparent),
             linear-gradient(90deg, var(--gold1), var(--gold2), var(--gold3), var(--gold4));
  box-shadow:0 8px 20px rgba(185,130,31,.35)
}
.row{display:flex;flex-wrap:wrap;gap:12px;justify-content:center}
a.btn,button.btn{display:inline-block;text-decoration:none;position:relative;border:0;cursor:pointer;
  padding:12px clamp(18px,2.6vw,28px);border-radius:18px;min-width:clamp(150px,22vw,220px);
  font-family:"Noto Kufi Arabic";font-weight:800;font-size:var(--fs-btn);color:#3a2706;letter-spacing:.2px;
  background:linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,0) 45%),
             linear-gradient(180deg,var(--gold1),var(--gold2) 30%,var(--gold3) 62%,var(--gold4));
  box-shadow:0 12px 26px rgba(185,130,31,.30), inset 0 1px 0 rgba(255,255,255,.85);
  transition:transform .15s ease, box-shadow .25s ease, filter .25s ease}
a.btn:before,button.btn:before{content:"";position:absolute;inset:0;border-radius:inherit;box-shadow:inset 0 0 0 1px rgba(185,130,31,.55), inset 0 -8px 14px rgba(0,0,0,.08);pointer-events:none}
a.btn:hover,button.btn:hover{transform:translateY(-2px);filter:saturate(1.06);box-shadow:0 18px 36px rgba(185,130,31,.36), inset 0 1px 0 rgba(255,255,255,.92)}
.btn.black{color:#fff;background:
  linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,0) 45%),
  linear-gradient(180deg,#272727,#161616 55%,#0b0b0b)}
.card{background:#fff;border-radius:22px;box-shadow:var(--sh-xl);padding:var(--space);margin:18px 0}
.section-title{font-family:"Noto Kufi Arabic";font-size:var(--fs-h2);margin:6px 0 12px;text-align:center}
.block-btn{width:100%;padding:18px;border-radius:18px;margin:12px 0;border:0;cursor:pointer;
  font-family:"Noto Kufi Arabic";font-size:clamp(20px,2.6vw,28px);font-weight:800;color:#3a2706;
  background:linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,0) 40%),
             linear-gradient(180deg, var(--gold1), var(--gold2) 30%, var(--gold3) 60%, var(--gold4));
  box-shadow:0 12px 26px rgba(185,130,31,.28), inset 0 1px 0 rgba(255,255,255,.78)}
.label{font-weight:700;margin-bottom:6px}
input,select{width:100%;padding:14px;border:1px solid #ead79f;border-radius:14px;background:#fff;font-size:clamp(14px,1.4vw,18px);box-shadow:inset 0 1px 3px rgba(0,0,0,.03)}
.hidden{display:none}
.hadith-box{
  margin:16px auto 0;max-width:1100px;padding:clamp(14px,2vw,20px);
  border-radius:18px;text-align:right;
  background: radial-gradient(160% 120% at 18% -30%, rgba(255,255,255,.55), transparent 55%),
             linear-gradient(180deg, var(--gold1), var(--gold2) 56%, var(--gold3));
  border:1px solid rgba(185,130,31,.35);box-shadow:var(--sh-md);color:#2b1f08
}
.hadith-box .q{font-family:"Noto Kufi Arabic",sans-serif;font-size:clamp(16px,1.6vw,19px);line-height:2.1;text-align:justify;text-justify:inter-word}
.hadith-box .src{margin-top:8px;font-size:clamp(12px,1.2vw,13px);text-align:center;opacity:.9}
.dua-text{font-family:"Noto Kufi Arabic",sans-serif;font-size:clamp(14px,1.4vw,17px);line-height:2.15;text-align:justify;text-justify:inter-word;margin-bottom:8px}
.result{background:#fffdf3;border:1px solid #f1e2b0;border-radius:18px;padding:var(--space)}
.item{background:linear-gradient(180deg,#fff7d4,#fff);border:1px solid #edd899;border-radius:14px;padding:10px 14px;margin:8px 0}
.ayah{font-family:"Tajawal";font-weight:700;font-size:var(--fs-ayah);line-height:2;color:#1b1406;margin-top:10px}
.badge{display:inline-block;background:linear-gradient(180deg,#fff7d4,#fbe9b1);border:1px solid #edd899;border-radius:999px;padding:6px 12px;margin:4px 6px 0 0;white-space:nowrap}
.blackbar{background:#0b0b0b;color:#fff;border-radius:12px;padding:10px 12px;margin:-6px 0 10px;overflow:auto}
.verse-card{background:#fff;border-radius:16px;border:1px solid #eee;box-shadow:var(--sh-md);padding:12px;margin:10px 0;cursor:pointer}
.verse-card:hover{box-shadow:0 18px 32px rgba(0,0,0,.12)}
@media (min-width:900px){ #search .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px} }
.footer{margin-top:26px;text-align:center}
.credit{display:inline-block;background:linear-gradient(180deg,#1a1a1a,#000);color:#fff;padding:10px 18px;border-radius:999px;border:1px solid rgba(255,255,255,.08);box-shadow:0 12px 26px rgba(0,0,0,.35)}
section.view{display:none}
section.view.active{display:block}
</style>

<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","name":"الخِيرة بالقرآن | استخارة من الصفحة اليمنى","url":"https://example.com/","description":"الخِيرة بالقرآن: استخارة من الصفحة اليمنى (السطر الأول) مع عرض رقم الصفحة، السورة والآية، ونص الآية والنتيجة. بحث برقم الصفحة أو كلمات أو السورة والآية.","potentialAction":{"@type":"SearchAction","target":"https://example.com/#search?q={query}","query-input":"required name=query"}}
</script>
</head>
<body>
<div class="container">

  <header class="medallion" aria-hidden="true"></header>

  <main>
    <!-- الرئيسية -->
    <section id="home" class="hero view active" aria-labelledby="pageTitle">
      <h1 id="pageTitle" class="title">الخِيرة بالقرآن</h1>
      <p>استخارة إلكترونية دقيقة من الصفحة اليمنى للقرآن الكريم.</p>
      <div class="divider" aria-hidden="true"></div>
      <nav class="row" style="margin-top:12px" aria-label="التنقّل الرئيسي">
        <a class="btn" href="#khira">خيرة جديدة</a>
        <a class="btn black" href="#search">بحث في الخيرة</a>
      </nav>
      <div class="hadith-box" id="hadithBox" role="complementary" aria-labelledby="hadithTitle">
        <h2 id="hadithTitle" class="hidden">حديث عن الاستخارة</h2>
        <div class="q" id="hadithText"></div>
        <div class="src" id="hadithSrc"></div>
      </div>
    </section>

    <!-- الخيرة -->
    <section id="khira" class="card view" aria-labelledby="khiraTitle">
      <h2 id="khiraTitle" class="section-title">خطوات عمل الخِيرة</h2>
      <ol style="margin:0 0 10px 0;line-height:2">
        <li>الأفضل الطهارة بالوضوء أو الغُسل، مع النيّة لله تعالى.</li>
        <li>قراءة الدعاء المأثور:</li>
      </ol>
      <div class="hadith-box" style="margin-top:10px">
        <div class="dua-text">
          اللّهم إنّي أستخيرُكَ بعِلمِكَ، وأستقدِرُكَ بقُدرَتِكَ، وأسألُكَ من فضلكَ العظيم،
          فإنّكَ تقدِرُ ولا أقدِر، وتعلَمُ ولا أعلَم، وأنتَ علّامُ الغُيوب.
          اللّهم إن كنتَ تعلمُ أنّ هذا الأمرَ — <b>وتُسمّيه باسمه</b> — خيرٌ لي في ديني ومعاشي وعاقبةِ أمري عاجلِه وآجلِه،
          فاقدُرْه لي ويسّرْه لي ثم بارِكْ لي فيه، وإن كنتَ تعلمُ أنّ هذا الأمرَ شرٌّ لي في ديني ومعاشي وعاقبةِ أمري عاجلِه وآجلِه،
          فاصرِفْه عنّي واصرِفْني عنه، واقدُرْ لي الخيرَ حيث كان، ثم أرضِني به.
        </div>
        <div class="src">دعاء الاستخارة</div>
      </div>
      <ol start="3" style="margin:10px 0 0;line-height:2">
        <li>الصلاة على محمد وآل محمد.</li>
        <li>اضغط <b>استخارة</b> لتظهر النتيجة (اليمين فقط).</li>
      </ol>
      <div class="row" style="margin-top:12px">
        <button class="btn" id="doBtn" type="button">استخارة</button>
        <a class="btn black" href="#home">رجوع للصفحة الرئيسية</a>
      </div>

      <div id="res-box" class="result hidden" style="margin-top:12px" aria-live="polite">
        <div id="res-tags"></div>
        <div class="item"><b>الخيرة:</b> <span id="vVerdict">—</span><br><b>الملاحظات:</b> <span id="vNotes">—</span></div>
        <div class="item"><b>الصفحة:</b> <span id="vPage">—</span> · <span id="vSA">—</span></div>
        <div class="blackbar">السطر الأول من الصفحة</div>
        <div id="res-text" class="ayah">—</div>
      </div>
    </section>

    <!-- البحث -->
    <section id="search" class="card view" aria-labelledby="searchTitle">
      <h2 id="searchTitle" class="section-title">البحث في نتائج الخيرة</h2>

      <div class="grid">
        <div>
          <button class="block-btn" type="button" data-open="pBox" aria-controls="pBox">بحث برقم الصفحة</button>
          <div id="pBox" class="card hidden">
            <label for="pageInput" class="label">اليمين فقط (١–٦٠٣ أعداد فردية):</label>
            <input id="pageInput" type="number" min="1" max="603" step="2" placeholder="مثال: ٣١١" inputmode="numeric">
            <div class="row" style="margin-top:10px">
              <button class="btn" id="lookupBtn" type="button">بحث</button>
              <button class="btn black" type="button" data-close="pBox">إغلاق</button>
            </div>
          </div>

          <button class="block-btn" type="button" data-open="kBox" aria-controls="kBox">بحث بالكلمات</button>
          <div id="kBox" class="card hidden">
            <label for="kwInput" class="label">ابحث في نصوص النتائج (مثال: رحمة، نصر، هلاك):</label>
            <input id="kwInput" type="text" placeholder="اكتب الكلمة هنا">
            <div class="row" style="margin-top:10px">
              <button class="btn" id="kwBtn" type="button">بحث</button>
              <button class="btn black" type="button" data-close="kBox">إغلاق</button>
            </div>
          </div>
        </div>

        <div>
          <button class="block-btn" type="button" data-open="sBox" aria-controls="sBox">بحث بالسورة والآية</button>
          <div id="sBox" class="card hidden">
            <label for="suraSelect" class="label">اختر سورة لعرض الآيات على صفحات فردية:</label>
            <div class="row">
              <select id="suraSelect" aria-label="اختيار سورة"></select>
              <button class="btn" id="suraBtn" type="button">عرض الآيات</button>
              <button class="btn black" type="button" data-close="sBox">إغلاق</button>
            </div>
            <div id="versesList" class="result hidden" style="margin-top:10px">
              <div class="blackbar">آيات هذه السورة على صفحات فردية</div>
              <div id="versesWrap"></div>
              <div class="badge">اضغط على بطاقة الآية لعرض النتيجة</div>
            </div>
          </div>
        </div>
      </div>

      <div id="searchResult" class="result hidden" style="margin-top:12px" aria-live="polite">
        <div id="searchTags"></div>
        <div class="item">
          <b>الصفحة:</b> <span id="sPage">—</span> · <span id="sSA">—</span><br>
          <b>الخيرة:</b> <span id="sVerdict">—</span><br>
          <b>الملاحظات:</b> <span id="sNotes">—</span>
        </div>
        <div class="blackbar">السطر الأول من الصفحة</div>
        <div id="searchText" class="ayah">—</div>
      </div>

      <div class="row" style="margin-top:6px">
        <a class="btn black" href="#home">رجوع للصفحة الرئيسية</a>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span class="credit">برمجة وتطوير: فاضل الريس</span>
  </footer>
</div>

<script>
/* ===== تنقّل + إعادة ضبط تمنع ظهور النتائج قبل الطلب ===== */
function resetKhira(){
  const bx=document.getElementById('res-box');
  if(bx) bx.classList.add('hidden');
  ['vVerdict','vNotes','vPage','vSA','res-text','res-tags'].forEach(id=>{
    const el=document.getElementById(id); if(!el) return;
    if(id==='res-tags') el.innerHTML=''; else el.textContent='—';
  });
}
function resetSearch(){
  ['pBox','kBox','sBox'].forEach(id=>{const el=document.getElementById(id); if(el) el.classList.add('hidden');});
  const sRes=document.getElementById('searchResult'); if(sRes) sRes.classList.add('hidden');
  const vList=document.getElementById('versesList'); if(vList) vList.classList.add('hidden');
  const vWrap=document.getElementById('versesWrap'); if(vWrap) vWrap.innerHTML='';
  const pg=document.getElementById('pageInput'); if(pg) pg.value='';
  const kw=document.getElementById('kwInput'); if(kw) kw.value='';
  const ss=document.getElementById('suraSelect'); if(ss) ss.value='';
  ['sPage','sSA','sVerdict','sNotes','searchText','searchTags'].forEach(id=>{
    const el=document.getElementById(id); if(!el) return;
    if(id==='searchTags') el.innerHTML=''; else el.textContent='—';
  });
}
function activate(id){
  document.querySelectorAll('section.view').forEach(s=>s.classList.remove('active'));
  const el=document.getElementById(id||'home'); if(el) el.classList.add('active');
  if(id==='khira') resetKhira();
  if(id==='search') resetSearch();
}
function showFromHash(){ const id=(location.hash||'#home').slice(1); activate(id); }
window.addEventListener('hashchange',showFromHash);

/* ===== أدوات ===== */
const $=id=>document.getElementById(id);
const toArabicDigits = (x) => String(x ?? "—").replace(/[0-9]/g, d => "٠١٢٣٤٥٦٧٨٩"[d]);

function verdictFrom(t=""){ 
  if(/نهي|ناه[ية]/.test(t)) return "ناهية"; 
  if(/ممتاز/.test(t)) return "ممتازة"; 
  if(/حسنة/.test(t)) return "حسنة"; 
  if(/وسط/.test(t)) return "وسط"; 
  if(/جيدة|جيد/.test(t)) return "جيدة"; 
  return "—"; 
}

function validatePage(p){
  const n=Number(p);
  if(!Number.isInteger(n)||n<1||n>603||n%2===0){alert("خطأ في رقم الصفحة\nالاستخارة على اليمين فقط: اختر عددًا فرديًا بين ١ و ٦٠٣.");return false;}
  if(!(String(n) in (window.PAGE_RESULT||{}))){alert("هذه الصفحة ليست ضمن جدول الاستخارة المضمَّن.");return false;}
  return true;
}

/* ===== جلب أول آية في الصفحة ===== */
async function firstAyahByPage(page){
  const pg=Number(page);
  try{
    const r=await fetch(`https://api.alquran.cloud/v1/page/${pg}/quran-uthmani`);
    if(r.ok){
      const j=await r.json();
      const ay=j?.data?.ayahs?.[0];
      if(ay && Number(j?.data?.page)===pg){
        return {text: ay.text || null, sura: Number(ay.surah?.number) || null, ayah: Number(ay.numberInSurah) || null};
      }
    }
  }catch(_){}
  try{
    const r2=await fetch(`https://api.quran.com/api/v4/verses/by_page/${pg}?language=ar&fields=text_uthmani,verse_key,chapter_id,page_number`);
    if(r2.ok){
      const j2=await r2.json();
      const v=j2?.verses?.[0];
      if(v){
        const parts=String(v.verse_key||"").split(":");
        return { text: v.text_uthmani||null, sura:Number(v.chapter_id||parts[0])||null, ayah:Number(parts[1])||null };
      }
    }
  }catch(_){}
  return {text:null,sura:null,ayah:null};
}

/* ===== عرض النتيجة بأمان ===== */
function renderResult(target, page, notes, ay){
  const safePage=Number(page);
  const verdict=verdictFrom(notes||"");
  const suraName=window.SURAH?.[Number(ay?.sura)] || (ay?.sura ? `سورة رقم ${toArabicDigits(ay.sura)}` : "—");
  const ayahNo=ay?.ayah ?? "—";
  const text=ay?.text || "(تعذّر جلب نص الآية)";
  const tagsHtml = `<span class="badge">صفحة: ${toArabicDigits(safePage)}</span><span class="badge">يمين · السطر الأول</span>`;

  if(target==="kh"){
    $("vVerdict").textContent=verdict; 
    $("vNotes").textContent=notes||"—"; 
    $("vPage").textContent=toArabicDigits(safePage);
    $("vSA").textContent=`${suraName} - الآية ${toArabicDigits(ayahNo)}`;
    $("res-text").textContent=text;
    $("res-tags").innerHTML=tagsHtml;
    $("res-box").classList.remove("hidden"); 
    $("res-box").scrollIntoView({behavior:"smooth",block:"center"});
  }else{
    $("sPage").textContent=toArabicDigits(safePage); 
    $("sSA").textContent=`${suraName} - الآية ${toArabicDigits(ayahNo)}`;
    $("sVerdict").textContent=verdict; 
    $("sNotes").textContent=notes||"—";
    $("searchText").textContent=text;
    $("searchTags").innerHTML=tagsHtml;
    $("searchResult").classList.remove("hidden"); 
    $("searchResult").scrollIntoView({behavior:"smooth",block:"center"});
  }
}

/* ===== تشغيل ===== */
document.addEventListener('DOMContentLoaded',()=>{ 
  showFromHash(); if(!document.querySelector('section.view.active')) activate('home');

  const HADITHS=[
    {t:"قال الإمام الصادق (عليه السلام): يقول الله عز وجل: من شقاء عبدي أن يعمل الأعمال ولا يستخير بي.", s:"المصدر: ميزان الحكمة"},
    {t:"قال الإمام الصادق (عليه السلام): من دخل في أمر بغير استخارة ثم ابتلي لم يؤجر.", s:"المصدر: ميزان الحكمة"},
    {t:"قال الإمام علي (عليه السلام): ما حار من استخار، ولا ندم من استشار.", s:"المصدر: ميزان الحكمة"},
    {t:"قال رسول الله (صلى الله عليه وآله): من سعادة ابن آدم استخارته الله ورضاه بما قضى الله، ومن شقوة ابن آدم تركه استخارة الله.", s:"المصدر: ميزان الحكمة"}
  ];
  const h=HADITHS[Math.floor(Math.random()*HADITHS.length)];
  $("hadithText").textContent=h.t; $("hadithSrc").textContent=h.s;

  const SURAH=["","الفاتحة","البقرة","آل عمران","النساء","المائدة","الأنعام","الأعراف","الأنفال","التوبة","يونس","هود","يوسف","الرعد","إبراهيم","الحجر","النحل","الإسراء","الكهف","مريم","طه","الأنبياء","الحج","المؤمنون","النور","الفرقان","الشعراء","النمل","القصص","العنكبوت","الروم","لقمان","السجدة","الأحزاب","سبإ","فاطر","يس","الصافات","ص","الزمر","غافر","فصلت","الشورى","الزخرف","الدخان","الجاثية","الأحقاف","محمد","الفتح","الحجرات","ق","الذاريات","الطور","النجم","القمر","الرحمن","الواقعة","الحديد","المجادلة","الحشر","الممتحنة","الصف","الجمعة","المنافقون","التغابن","الطلاق","التحريم","الملك","القلم","الحاقة","المعارج","نوح","الجن","المزمل","المدثر","القيامة","الإنسان","المرسلات","النبأ","النازعات","عبس","التكوير","الانفطار","المطففين","الانشقاق","البروج","الطارق","الأعلى","الغاشية","الفجر","البلد","الشمس","الليل","الضحى","الشرح","التين","العلق","القدر","البينة","الزلزلة","العاديات","القارعة","التكاثر","العصر","الهمزة","الفيل","قريش","الماعون","الكوثر","الكافرون","النصر","المسد","الإخلاص","الفلق","الناس"];
  window.SURAH=SURAH;

  const suraSelect=$("suraSelect");
  SURAH.forEach((s,i)=>{ if(i>0){ const opt=document.createElement("option"); opt.value=i; opt.textContent=s; suraSelect.appendChild(opt); } });

  // البيانات المضمنة (يفترض أنها موجودة في ملف منفصل أو تم تحميلها ديناميكيًا)
  // window.PAGE_RESULT = { ... };

  $("doBtn").addEventListener('click',async()=>{ 
    resetKhira();
    const randomPage=Math.floor(Math.random()*302)*2+1; // أعداد فردية من 1 إلى 603
    const res=window.PAGE_RESULT?.[String(randomPage)];
    if(res){
      const ay=await firstAyahByPage(randomPage);
      renderResult("kh",randomPage,res.notes,ay);
    }else{
      alert("تعذر جلب نتيجة الاستخارة لهذه الصفحة.");
    }
  });

  $("lookupBtn").addEventListener('click',async()=>{ 
    resetSearch();
    const page=$("pageInput").value;
    if(validatePage(page)){
      const res=window.PAGE_RESULT?.[page];
      if(res){
        const ay=await firstAyahByPage(page);
        renderResult("search",page,res.notes,ay);
      }else{
        alert("تعذر جلب نتيجة الاستخارة لهذه الصفحة.");
      }
    }
  });

  $("kwBtn").addEventListener('click',async()=>{ 
    resetSearch();
    const kw=$("kwInput").value.trim();
    if(kw.length<2){alert("الرجاء إدخال كلمتين على الأقل للبحث.");return;}
    
    const matchingPages=Object.entries(window.PAGE_RESULT||{}).filter(([,val])=>val.notes.includes(kw));
    if(matchingPages.length>0){
      const firstMatchPage=matchingPages[0][0];
      const res=window.PAGE_RESULT?.[firstMatchPage];
      if(res){
        const ay=await firstAyahByPage(firstMatchPage);
        renderResult("search",firstMatchPage,res.notes,ay);
      }
    }else{
      alert("لم يتم العثور على نتائج مطابقة للكلمة المدخلة.");
    }
  });

  $("suraBtn").addEventListener('click',async()=>{ 
    resetSearch();
    const suraId=$("suraSelect").value;
    if(!suraId){alert("الرجاء اختيار سورة.");return;}

    const versesWrap=$("versesWrap");
    versesWrap.innerHTML='';

    const pagesInSura=Object.entries(window.PAGE_RESULT||{}).filter(([,val])=>val.sura==suraId);
    if(pagesInSura.length>0){
      for(const [page,res] of pagesInSura){
        const ay=await firstAyahByPage(page);
        if(ay && ay.sura==suraId){
          const card=document.createElement('div');
          card.className='verse-card';
          card.innerHTML=`<b>${SURAH[suraId]} - الآية ${toArabicDigits(ay.ayah)}</b><br>${ay.text}`;
          card.dataset.page=page;
          card.dataset.notes=res.notes;
          card.addEventListener('click',async()=>{ 
            resetSearch();
            const clickedPage=card.dataset.page;
            const clickedNotes=card.dataset.notes;
            const clickedAyah=await firstAyahByPage(clickedPage);
            renderResult("search",clickedPage,clickedNotes,clickedAyah);
          });
          versesWrap.appendChild(card);
        }
      }
      $("versesList").classList.remove("hidden");
    }else{
      alert("لا توجد آيات لهذه السورة في صفحات فردية ضمن جدول الاستخارة.");
    }
  });

  document.querySelectorAll('[data-open]').forEach(btn=>{
    btn.addEventListener('click',e=>{
      const targetId=e.target.dataset.open;
      document.getElementById(targetId).classList.remove('hidden');
    });
  });
  document.querySelectorAll('[data-close]').forEach(btn=>{
    btn.addEventListener('click',e=>{
      const targetId=e.target.dataset.close;
      document.getElementById(targetId).classList.add('hidden');
    });
  });
});
</script>
</body>
</html>
